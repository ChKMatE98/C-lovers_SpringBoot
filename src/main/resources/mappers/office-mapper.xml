<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Office">

	<!-- 오피스 정보 불러오기 -->
	<select id="selectOfficeInfo"
		resultType="com.clovers.dto.OfficeDTO">
		select * from office;
	</select>
	<!-- // 부서 명 불러오기 -->
	<select id="selectDeptTaskAll"
		resultType="com.clovers.dto.DeptTaskDTO">
		select * from dept_task;
	</select>

	<!-- // 직급 명 불러오기 -->
	<select id="selectPositionAll"
		resultType="com.clovers.dto.JobDTO">
		select * from job;
	</select>

	<!-- // 사용자 수 불러오기 -->
	<select id="selectEmpCount" resultType="int">
		select substring(id, char_length(id)-2) as last_three_digits
		from employee
		order by cast(substring(id, -3) as unsigned) desc
		limit 1;
	</select>

	<!-- 사용자 리스트 맵 -->
	<resultMap type="HashMap" id="userList">
		<id column="id" property="id" />
		<result column="name" property="name" />
		<result column="job_name" property="job_name" />
		<result column="task_name" property="task_name" />
	</resultMap>

	<!-- 사용자 리스트 불러오기 -->
	<select id="selectUserList" resultMap="userList">
		select name, id, job_name, task_name 
		from mypageData 
		order by cast(right(id,3)as unsigned) desc;
	</select>
	
	<!-- // 사내 전화번호 사용중인지 체크 -->
	<select id="usingCompanyPhoneCheck" resultType="Integer">
		select count(*) from employee where company_phone=#{companyPhone};
	</select>


	<!-- // 사용자 등록하기 -->
	<insert id="insertUser">
		insert into employee values (#{id},#{name}, #{pw},
		#{birth}, #{email}, #{phone}, #{hire_date}, null, true, #{job_id},
		#{dept_task_id},"재직", #{profile_img}, "정상1", #{company_email}, #{company_phone});
	</insert>

	<!-- // 사용자 삭제하기 -->
	<delete id="deleteUser" parameterType="List">
		delete from employee where id in
		<foreach collection="list" item="item" separator="," open="("
			close=")">
			#{item}
		</foreach>
	</delete>


<!-- 	오피스 이름 수정하기 -->
	<update id="updateOfficeName">
		update office set office_name = #{office_name} where id =#{id};
	</update>
	<!-- // 사용자 직위 수정하기 -->
	<update id="updateUserJob">
		update employee set job_id=#{job_id} where id =#{id};
	</update>

	<!-- // 사용자 소속 조직 수정 -->
	<update id="updateUserDeptTask">
		update employee set dept_task_id=#{dept_task_id}
		where id=#{id};
	</update>

	<!-- // 사용자 이름, id 검색하기 -->
	<select id="searchUser" resultMap="userList">
		select name, id, job_name, task_name 
		from mypageData 
		where e.id like #{keyword} or e.name like #{keyword} 
		order by cast(right(id,3)as unsigned) desc;
	</select>
</mapper>